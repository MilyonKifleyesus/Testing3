<div class="main-container container-fluid px-0">
  <!-- Page Header -->
  <div class="d-md-flex d-block align-items-center justify-content-between my-4 page-header-breadcrumb">
    <div>
      <h1 class="page-title fw-semibold fs-20 mb-1">Inspectors</h1>
      <p class="mb-0 text-muted fs-13">User Management • Inspector sub-category</p>
    </div>
    <div class="btn-list d-flex gap-2 align-items-center">
      <!-- View Toggle Buttons -->
      <div class="btn-group" role="group">
        <button type="button" 
                class="btn btn-sm" 
                [ngClass]="viewMode === 'card' ? 'btn-primary' : 'btn-outline-primary'"
                (click)="toggleViewMode('card')"
                title="Card View">
          <i class="ti ti-layout-grid me-1"></i>Cards
        </button>
        <button type="button" 
                class="btn btn-sm" 
                [ngClass]="viewMode === 'table' ? 'btn-primary' : 'btn-outline-primary'"
                (click)="toggleViewMode('table')"
                title="Table View">
          <i class="ti ti-table me-1"></i>Table
        </button>
      </div>

      <!-- Add Inspector Button -->
      <button class="btn btn-primary btn-wave" routerLink="/admin/users/inspectors/add">
        <i class="ti ti-user-plus me-2"></i>Add Inspector
      </button>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="mb-4">
    <div class="search-box search-box-compact">
      <input type="text" 
             class="form-control" 
             placeholder="Search by name, username, or ID..."
             [(ngModel)]="searchQuery"
             (input)="filterInspectors()">
      <i class="ti ti-search search-icon-left"></i>
      <button class="btn-clear" 
              *ngIf="searchQuery"
              (click)="clearSearch()"
              type="button"
              title="Clear search">
        <i class="ti ti-x"></i>
      </button>
    </div>
  </div>

  <!-- Card View -->
  <div *ngIf="viewMode === 'card'" class="row g-3">
    <div class="col-xxl-3 col-xl-3 col-lg-4 col-md-6" *ngFor="let inspector of inspectors">
      <div class="flip-card-wrapper" 
           (mouseenter)="flipCard(inspector.id)" 
           (mouseleave)="unflipCard(inspector.id)">
        <div class="flip-card" [class.flipped]="isCardFlipped(inspector.id)">
          <!-- Front Side -->
          <div class="flip-card-front">
            <div class="card inspector-card h-100">
              <!-- Header Background Gradient -->
              <div class="card-header-gradient" [style.background]="inspector.avatarBg" style="opacity: 0.1;"></div>
              
              <div class="card-body p-4 d-flex flex-column">
                <!-- Avatar -->
                <div class="inspector-avatar-container mb-4">
                  <div class="inspector-avatar-large" [style.background]="inspector.avatarBg">
                    <span>{{getInitials(inspector.fullName)}}</span>
                  </div>
                </div>

                <!-- Name -->
                <h5 class="mb-1 text-center fw-bold fs-18">{{inspector.fullName}}</h5>
                <p class="text-center text-muted small mb-3">{{inspector.name}}</p>

                <!-- Location Badge -->
                <div class="text-center mb-4">
                  <span class="badge bg-primary-transparent">
                    <i class="ti ti-map-pin me-1"></i>{{inspector.location}}
                  </span>
                </div>

                <!-- Quick Stats Row -->
                <div class="row g-2 mb-4">
                  <div class="col-6">
                    <div class="quick-stat">
                      <div class="stat-number text-primary fw-bold">{{inspector.busesInspected}}</div>
                      <div class="stat-label text-muted small">Inspected</div>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="quick-stat">
                      <div class="stat-number rating-display fw-bold">
                        <i class="ti ti-star-filled me-1"></i>{{inspector.rating}}.0
                      </div>
                      <div class="stat-label text-muted small">Rating</div>
                    </div>
                  </div>
                </div>

                <!-- Role & Status -->
                <div class="role-status-container mb-auto pt-2">
                  <span class="badge bg-success-transparent me-2">
                    <i class="ti ti-user-check me-1"></i>Inspector
                  </span>
                  <span class="badge bg-info-transparent">
                    <i class="ti ti-circle-filled me-1 fs-10"></i>Active
                  </span>
                </div>

                <!-- Hover hint -->
                <div class="text-center mt-4 pt-3 border-top">
                  <small class="text-muted">
                    <i class="ti ti-hand-stop me-1"></i>Hover to see details
                  </small>
                </div>
              </div>
            </div>
          </div>

          <!-- Back Side -->
          <div class="flip-card-back">
            <div class="card inspector-card h-100">
              <div class="card-body p-3 d-flex flex-column">
                <!-- Back Side Header -->
                <div class="back-card-header mb-3 pb-3 border-bottom">
                  <h6 class="mb-0 fw-bold">Performance & Details</h6>
                </div>

                <!-- Scrollable Content -->
                <div class="flex-grow-1 overflow-auto pe-2 me-2">
                  <!-- Main Stats Grid -->
                  <div class="row g-2 mb-3">
                    <div class="col-6">
                      <div class="stat-box modern">
                        <div class="stat-icon text-success">
                          <i class="ti ti-clipboard-check"></i>
                        </div>
                        <small class="text-muted d-block mb-1">Inspected</small>
                        <div class="fw-bold fs-18 text-success">{{inspector.busesInspected}}</div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="stat-box modern">
                        <div class="stat-icon text-info">
                          <i class="ti ti-bus"></i>
                        </div>
                        <small class="text-muted d-block mb-1">Assigned</small>
                        <div class="fw-bold fs-18 text-info">{{inspector.busesAssigned}}</div>
                      </div>
                    </div>
                  </div>

                  <!-- Performance Badges -->
                  <div class="mb-3 p-2 bg-light rounded">
                    <small class="d-block text-muted mb-2 fw-bold">Rating & Performance</small>
                    <div class="d-flex align-items-center gap-2">
                      <span class="fs-18 fw-bold rating-display">
                        <i class="ti ti-star-filled me-1"></i>{{inspector.rating}}.0
                      </span>
                      <span class="badge bg-success-transparent">{{inspector.rating >= 4 ? 'Excellent' : 'Good'}}</span>
                    </div>
                  </div>

                  <!-- Tests Section -->
                  <div class="mb-3">
                    <small class="d-block text-muted mb-2 fw-bold">Test Coverage</small>
                    <div class="d-flex gap-2 flex-wrap">
                      <span class="badge bg-secondary-transparent fs-11 py-2">
                        <i class="ti ti-road me-1"></i>{{inspector.tests.road}} Road Tests
                      </span>
                      <span class="badge bg-info-transparent fs-11 py-2">
                        <i class="ti ti-windmill me-1"></i>{{inspector.tests.water}} Water Tests
                      </span>
                    </div>
                  </div>

                  <!-- Snags Section -->
                  <div class="mb-3 p-2 bg-danger-transparent rounded">
                    <small class="d-block text-muted mb-2 fw-bold">Snags Summary</small>
                    <div class="row g-2">
                      <div class="col-6">
                        <div class="small">
                          <span class="d-block text-muted fs-11">Total Snags</span>
                          <span class="fw-bold fs-16 text-danger">{{inspector.snags.total}}</span>
                        </div>
                      </div>
                      <div class="col-6">
                        <div class="small">
                          <span class="d-block text-muted fs-11">Safety Critical</span>
                          <span class="fw-bold fs-16 text-danger">{{inspector.snags.safetyCritical}}</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Location Info -->
                  <div class="mb-3 p-2 bg-primary-transparent rounded">
                    <small class="d-block text-muted mb-1 fw-bold">
                      <i class="ti ti-map-pin me-1"></i>Location
                    </small>
                    <span class="fw-semibold small">{{inspector.location}}</span>
                  </div>

                  <!-- ID & Username -->
                  <div class="mb-3 p-2 bg-light rounded">
                    <small class="d-block text-muted mb-2">ID & Access Info</small>
                    <div class="small mb-2">
                      <span class="text-muted">ID:</span>
                      <span class="fw-semibold ms-1">{{inspector.id}}</span>
                    </div>
                    <div class="small">
                      <span class="text-muted">Username:</span>
                      <span class="fw-semibold ms-1">{{inspector.name}}</span>
                    </div>
                  </div>
                </div>

                <!-- Fixed Actions at Bottom -->
                <div class="d-grid gap-2 mt-2">
                  <button class="btn btn-sm btn-primary" [routerLink]="['/admin/users/inspectors', inspector.id]">
                    <i class="ti ti-eye me-1"></i>View Profile
                  </button>
                  <button class="btn btn-sm btn-secondary" (click)="showMessageModal(inspector)">
                    <i class="ti ti-mail me-1"></i>Send Message
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Table View -->
  <div *ngIf="viewMode === 'table'" class="table-responsive">
    <table class="table table-hover mb-0">
      <thead class="table-header-sticky">
        <tr>
          <th style="width: 10%;">ID</th>
          <th style="width: 30%;">Name</th>
          <th style="width: 25%;">Username</th>
          <th style="width: 20%;">Role</th>
          <th style="width: 15%;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let inspector of filteredInspectors" class="inspector-table-row">
          <td>
            <small class="fw-semibold text-primary">{{inspector.id}}</small>
          </td>
          <td>
            <div class="d-flex align-items-center gap-2">
              <div class="inspector-avatar-small-table" [style.background]="inspector.avatarBg">
                {{getInitials(inspector.fullName)}}
              </div>
              <div>
                <p class="mb-0 fw-semibold">{{inspector.fullName}}</p>
              </div>
            </div>
          </td>
          <td>
            <small class="fw-semibold">{{inspector.name}}</small>
          </td>
          <td>
            <span class="badge bg-success-transparent">
              <i class="ti ti-user-check me-1"></i>Inspector
            </span>
          </td>
          <td>
            <div class="d-flex gap-2">
              <button class="btn btn-icon btn-sm btn-primary-light" 
                      [routerLink]="['/admin/users/inspectors', inspector.id]"
                      title="View Profile">
                <i class="ti ti-eye"></i>
              </button>
              <button class="btn btn-icon btn-sm btn-secondary-light" 
                      (click)="showMessageModal(inspector)"
                      title="Send Message">
                <i class="ti ti-mail"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="filteredInspectors.length === 0">
          <td colspan="5" class="text-center py-4">
            <p class="text-muted mb-0">No inspectors found matching your search.</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<div class="message-modal" [class.active]="isMessageModalOpen" *ngIf="isMessageModalOpen">
  <div class="modal-overlay" (click)="closeMessageModal()"></div>
  <div class="modal-dialog-wrapper">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="ti ti-mail me-2"></i>Send Message to {{selectedInspector?.fullName}}
          </h5>
          <button type="button" class="btn-close" (click)="closeMessageModal()" aria-label="Close">
            <i class="ti ti-x"></i>
          </button>
        </div>
        <div class="modal-body">
          <!-- Recipient Info -->
          <div class="recipient-card mb-3">
            <div class="d-flex align-items-center gap-3">
              <div class="inspector-avatar-small" [style.background]="selectedInspector?.avatarBg">
                <span>{{getInitials(selectedInspector?.fullName || '')}}</span>
              </div>
              <div class="flex-grow-1">
                <div class="fw-semibold fs-15">{{selectedInspector?.fullName}}</div>
                <div class="text-muted small">{{selectedInspector?.name}} • {{selectedInspector?.location}}</div>
              </div>
            </div>
          </div>

          <!-- Subject -->
          <div class="mb-3">
            <label for="messageSubject" class="form-label fw-semibold">Subject <span class="text-danger">*</span></label>
            <input type="text" 
                   class="form-control" 
                   id="messageSubject" 
                   [(ngModel)]="messageData.subject"
                   placeholder="Enter message subject"
                   autocomplete="off">
          </div>

          <!-- Message Body -->
          <div class="mb-3">
            <label for="messageBody" class="form-label fw-semibold">Message <span class="text-danger">*</span></label>
            <textarea class="form-control" 
                      id="messageBody" 
                      [(ngModel)]="messageData.body"
                      rows="6" 
                      placeholder="Type your message here..."></textarea>
          </div>

          <!-- Priority -->
          <div class="mb-3">
            <label for="messagePriority" class="form-label fw-semibold">Priority</label>
            <select class="form-select" 
                    id="messagePriority" 
                    [(ngModel)]="messageData.priority">
              <option value="normal">Normal Priority</option>
              <option value="high">High Priority</option>
              <option value="urgent">Urgent Priority</option>
            </select>
          </div>

          <!-- Send Copy -->
          <div class="form-check">
            <input class="form-check-input" 
                   type="checkbox" 
                   id="sendCopy" 
                   [(ngModel)]="messageData.sendCopy">
            <label class="form-check-label" for="sendCopy">
              Send me a copy of this message
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-light" (click)="closeMessageModal()">
            <i class="ti ti-x me-1"></i>Cancel
          </button>
          <button type="button" class="btn btn-primary" (click)="sendMessage()">
            <i class="ti ti-send me-1"></i>Send Message
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
